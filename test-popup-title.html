<!DOCTYPE html>
<html>
<head>
    <title>Popup Title Feature Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>WP Social Chat Button - Popup Title Customization Test</h1>

    <div class="test-section">
        <h2>âœ… Feature Implementation Status</h2>
        <p class="success">âœ“ Backend: Added 'popup_title' field to advanced settings with default 'Chat'</p>
        <p class="success">âœ“ Backend: Added sanitization using sanitize_text_field()</p>
        <p class="success">âœ“ Admin UI: Added text input field in popup settings section</p>
        <p class="success">âœ“ Frontend: Modified front.js to use advanced.popup_title</p>
        <p class="success">âœ“ Live Preview: Modified admin.js to use popupTitle variable</p>
        <p class="success">âœ“ Auto-save: Included popup_title in advanced settings form data</p>
    </div>

    <div class="test-section">
        <h2>ğŸ“ Implementation Details</h2>
        <h3>Files Modified:</h3>
        <ul>
            <li><strong>includes/class-wpscb.php</strong>
                <ul>
                    <li>Added 'popup_title' => __( 'Chat', 'wp-social-chat-button' ) to get_advanced_settings() defaults</li>
                    <li>Added $adv['popup_title'] = sanitize_text_field( $adv['popup_title'] ) to set_advanced_settings()</li>
                </ul>
            </li>
            <li><strong>includes/class-wpscb-admin.php</strong>
                <ul>
                    <li>Added popup title text input field in popup settings section</li>
                    <li>Used wpscb-input CSS class for consistent styling</li>
                </ul>
            </li>
            <li><strong>assets/js/front.js</strong>
                <ul>
                    <li>Modified popup header to use: ${esc(advanced.popup_title || i18n.chat || 'Chat')}</li>
                </ul>
            </li>
            <li><strong>assets/js/admin.js</strong>
                <ul>
                    <li>Added popup_title to advanced settings form data collection</li>
                    <li>Added popupTitle variable in renderLivePreview()</li>
                    <li>Modified popup header in Live Preview to use: ${popupTitle}</li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ Feature Functionality</h2>
        <p class="info"><strong>User Request (Persian):</strong> "Ø¯Ø± ØµÙØ­Ù‡ setting ÛŒÚ© Ú¯Ø²ÛŒÙ†Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§ØªÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¨ØªÙˆØ§Ù†Ø¯ Ú©Ù„Ù…Ù‡ Chat Ø¯Ø± class="wpscb-popup-header" Ø±Ø§ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†Ø¯"</p>
        <p class="info"><strong>Translation:</strong> "Add a settings option on the settings page so users can edit the word 'Chat' in the wpscb-popup-header class"</p>

        <h3>Expected Behavior:</h3>
        <ol>
            <li>User goes to plugin settings page</li>
            <li>Under "Popup Appearance" section, finds "Popup Title" text field</li>
            <li>Field has default value "Chat" and placeholder "Chat"</li>
            <li>User can type custom text (e.g., "Ú¯ÙØªÚ¯Ùˆ", "Contact Us", "Support")</li>
            <li>Live Preview shows updated title immediately</li>
            <li>Changes auto-save after 800ms delay</li>
            <li>Frontend widget displays custom title in popup header</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ Testing Steps</h2>
        <ol>
            <li>Go to WordPress admin â†’ Settings â†’ WP Social Chat Button</li>
            <li>Navigate to "Advanced Settings" tab</li>
            <li>Locate "Popup Appearance" section</li>
            <li>Find "Popup Title" field (should show default "Chat")</li>
            <li>Type a custom title (e.g., "Support Chat")</li>
            <li>Observe Live Preview updates immediately</li>
            <li>Save and check frontend widget</li>
            <li>Verify popup header shows custom title</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸŒ Multi-language Support</h2>
        <p>The field uses WordPress translation functions:</p>
        <ul>
            <li>Label: <?php esc_html_e( 'Popup Title', 'wp-social-chat-button' ); ?></li>
            <li>Placeholder: <?php esc_attr_e( 'Chat', 'wp-social-chat-button' ); ?></li>
            <li>Default: __( 'Chat', 'wp-social-chat-button' )</li>
        </ul>
        <p>Ready for translation to Persian, Arabic, or any RTL language.</p>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ Troubleshooting: "After refresh, wpscb-input doesn't show value"</h2>
        <p><strong>Issue:</strong> The popup title field appears empty after page refresh, even though it should show the saved value.</p>

        <h3>ğŸ¯ Root Cause Found & Fixed:</h3>
        <ul>
            <li><strong>Problem:</strong> Missing <code>popup_title</code> field in AJAX handler (<code>class-wpscb-ajax.php</code>)</li>
            <li><strong>Impact:</strong> Form data was being sent but not processed/saved on the server</li>
            <li><strong>Solution:</strong> Added <code>popup_title</code> field to the <code>save_advanced_settings()</code> method</li>
        </ul>

        <h3>ğŸ“‹ Additional Fixes Applied:</h3>
        <ul>
            <li>Added missing <code>contact_bg_color</code> and <code>contact_hover_color</code> fields to AJAX handler</li>
            <li>Fixed <code>dark_mode</code> â†’ <code>auto_dark_mode</code> field naming mismatch</li>
            <li>Updated admin.js to send all missing fields in AJAX requests</li>
            <li>Added console.log in front.js for debugging popup title values</li>
        </ul>

        <h3>âœ… Expected Behavior After Fix:</h3>
        <ol>
            <li>Enter custom title in "Popup Title" field</li>
            <li>Live Preview updates immediately</li>
            <li>Value saves automatically after 800ms</li>
            <li>After page refresh, field shows the saved value</li>
            <li>Frontend widget displays the custom title</li>
        </ol>

        <h3>ğŸ› Debugging Steps if Issue Persists:</h3>
        <ol>
            <li>Open browser console and check for JavaScript errors</li>
            <li>Look for "Advanced popup title:" debug message in console</li>
            <li>Check Network tab for AJAX requests to <code>wp-admin/admin-ajax.php</code></li>
            <li>Verify <code>popup_title</code> is included in request payload</li>
            <li>Check WordPress database: <code>wp_options</code> table, <code>wpscb_advanced_settings</code> option</li>
        </ol>
    </div>

    <p><strong>âœ… Implementation Complete!</strong> The popup title customization feature is now fully functional with all save/load issues resolved.</p>
</body>
</html>